/**
 * This source code is licensed under the terms of the
 * GNU Affero General Public License found in the LICENSE file in
 * the root directory of this source tree.
 *
 * Copyright (c) 2021-present Kaleidos INC
 */

/**
 * CJK (Chinese, Japanese, Korean) Typography Optimizations
 * Improves readability and appearance for East Asian languages
 */

/* CJK Font Stacks */
html[lang="zh-hans"], html[lang="zh-hant"], html[lang="ja"], html[lang="ko"] {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", 
                 "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", 
                 "Helvetica Neue", Helvetica, Arial, sans-serif;
}

/* Simplified Chinese */
html[lang="zh-hans"] {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                 "PingFang SC", "Hiragino Sans GB", "Source Han Sans SC",
                 "Noto Sans CJK SC", "Microsoft YaHei", "微软雅黑",
                 "Helvetica Neue", Helvetica, Arial, sans-serif;
}

/* Traditional Chinese */
html[lang="zh-hant"] {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                 "PingFang TC", "Hiragino Sans CNS", "Source Han Sans TC",
                 "Noto Sans CJK TC", "Microsoft JhengHei", "微軟正黑體",
                 "Helvetica Neue", Helvetica, Arial, sans-serif;
}

/* Japanese */
html[lang="ja"] {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                 "Hiragino Kaku Gothic ProN", "Hiragino Sans", "Yu Gothic",
                 "Source Han Sans JP", "Noto Sans CJK JP", "Meiryo",
                 "Helvetica Neue", Helvetica, Arial, sans-serif;
}

/* Korean */
html[lang="ko"] {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                 "Apple SD Gothic Neo", "Malgun Gothic", "Source Han Sans KR",
                 "Noto Sans CJK KR", "Helvetica Neue", Helvetica, Arial, sans-serif;
}

/* CJK Text Rendering Optimizations */
html[lang="zh-hans"] body,
html[lang="zh-hant"] body,
html[lang="ja"] body,
html[lang="ko"] body {
    /* Better text rendering for CJK */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    
    /* Slightly increase line height for better readability */
    line-height: 1.7;
    
    /* Adjust letter spacing */
    letter-spacing: 0.03em;
}

/* CJK Headings */
html[lang="zh-hans"],
html[lang="zh-hant"],
html[lang="ja"],
html[lang="ko"] {
    h1, h2, h3, h4, h5, h6 {
        font-weight: 600;
        letter-spacing: 0.02em;
        line-height: 1.5;
    }
    
    h1 { font-weight: 700; }
    h2 { font-weight: 650; }
}

/* CJK Paragraph Spacing */
html[lang="zh-hans"] p,
html[lang="zh-hant"] p,
html[lang="ja"] p,
html[lang="ko"] p {
    margin-bottom: 1.2em;
    text-align: justify;
    text-justify: inter-ideograph;
}

/* CJK Code and Monospace */
html[lang="zh-hans"] code,
html[lang="zh-hans"] pre,
html[lang="zh-hant"] code,
html[lang="zh-hant"] pre,
html[lang="ja"] code,
html[lang="ja"] pre,
html[lang="ko"] code,
html[lang="ko"] pre {
    font-family: "SF Mono", Monaco, "Cascadia Code", Menlo, Consolas,
                 "PingFang SC", "Microsoft YaHei", monospace;
}

/* CJK Input Fields */
html[lang="zh-hans"] input,
html[lang="zh-hans"] textarea,
html[lang="zh-hans"] select,
html[lang="zh-hant"] input,
html[lang="zh-hant"] textarea,
html[lang="zh-hant"] select,
html[lang="ja"] input,
html[lang="ja"] textarea,
html[lang="ja"] select,
html[lang="ko"] input,
html[lang="ko"] textarea,
html[lang="ko"] select {
    font-family: inherit;
    letter-spacing: 0.02em;
}

/* CJK Buttons */
html[lang="zh-hans"] button,
html[lang="zh-hant"] button,
html[lang="ja"] button,
html[lang="ko"] button {
    font-weight: 500;
    letter-spacing: 0.05em;
}

/* Word Breaking for CJK */
html[lang="zh-hans"] *,
html[lang="zh-hant"] *,
html[lang="ja"] *,
html[lang="ko"] * {
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: keep-all;
}

/* Allow breaking for long CJK strings in specific contexts */
html[lang="zh-hans"] .long-text,
html[lang="zh-hans"] .description,
html[lang="zh-hans"] .comment-content,
html[lang="zh-hant"] .long-text,
html[lang="zh-hant"] .description,
html[lang="zh-hant"] .comment-content,
html[lang="ja"] .long-text,
html[lang="ja"] .description,
html[lang="ja"] .comment-content,
html[lang="ko"] .long-text,
html[lang="ko"] .description,
html[lang="ko"] .comment-content {
    word-break: break-all;
}

/* CJK Quotation Marks */
html[lang="zh-hans"] q::before { content: "\201C"; }  /* " */
html[lang="zh-hans"] q::after { content: "\201D"; }   /* " */
html[lang="zh-hans"] q q::before { content: "\2018"; } /* ' */
html[lang="zh-hans"] q q::after { content: "\2019"; }  /* ' */

html[lang="zh-hant"] q::before { content: "\300C"; }  /* 「 */
html[lang="zh-hant"] q::after { content: "\300D"; }   /* 」 */
html[lang="zh-hant"] q q::before { content: "\300E"; } /* 『 */
html[lang="zh-hant"] q q::after { content: "\300F"; }  /* 』 */

html[lang="ja"] q::before { content: "\300C"; }  /* 「 */
html[lang="ja"] q::after { content: "\300D"; }   /* 」 */
html[lang="ja"] q q::before { content: "\300E"; } /* 『 */
html[lang="ja"] q q::after { content: "\300F"; }  /* 』 */

/* CJK List Markers */
html[lang="zh-hans"] ol,
html[lang="zh-hant"] ol,
html[lang="ja"] ol,
html[lang="ko"] ol {
    list-style-type: cjk-decimal;
}

/* Adjust spacing for mixed content (CJK + Latin) */
html[lang="zh-hans"] .mixed-content,
html[lang="zh-hant"] .mixed-content,
html[lang="ja"] .mixed-content,
html[lang="ko"] .mixed-content {
    /* Add small spacing between CJK and Latin characters */
    -webkit-text-spacing: ideograph-alpha ideograph-numeric;
}

/* CJK Emphasis */
html[lang="zh-hans"] em,
html[lang="zh-hant"] em,
html[lang="ja"] em,
html[lang="ko"] em {
    font-style: normal;
    text-emphasis-style: dot;
    text-emphasis-position: under;
    -webkit-text-emphasis-style: dot;
    -webkit-text-emphasis-position: under;
}

/* CJK Strong */
html[lang="zh-hans"] strong,
html[lang="zh-hant"] strong,
html[lang="ja"] strong,
html[lang="ko"] strong {
    font-weight: 600;
}

/* Specific adjustments for Taiga UI components */
html[lang="zh-hans"] .task-name,
html[lang="zh-hans"] .us-title,
html[lang="zh-hans"] .issue-subject,
html[lang="zh-hant"] .task-name,
html[lang="zh-hant"] .us-title,
html[lang="zh-hant"] .issue-subject,
html[lang="ja"] .task-name,
html[lang="ja"] .us-title,
html[lang="ja"] .issue-subject,
html[lang="ko"] .task-name,
html[lang="ko"] .us-title,
html[lang="ko"] .issue-subject {
    font-weight: 500;
    letter-spacing: 0.02em;
}

/* Markdown content CJK optimization */
html[lang="zh-hans"] .markdown-content,
html[lang="zh-hant"] .markdown-content,
html[lang="ja"] .markdown-content,
html[lang="ko"] .markdown-content {
    line-height: 1.8;
}

/* Table content for CJK */
html[lang="zh-hans"] table,
html[lang="zh-hant"] table,
html[lang="ja"] table,
html[lang="ko"] table {
    font-variant-numeric: lining-nums tabular-nums;
}

/* Better number display in CJK context */
html[lang="zh-hans"] .number,
html[lang="zh-hans"] .count,
html[lang="zh-hans"] .date,
html[lang="zh-hant"] .number,
html[lang="zh-hant"] .count,
html[lang="zh-hant"] .date,
html[lang="ja"] .number,
html[lang="ja"] .count,
html[lang="ja"] .date,
html[lang="ko"] .number,
html[lang="ko"] .count,
html[lang="ko"] .date {
    font-feature-settings: "tnum", "lnum";
    font-variant-numeric: lining-nums tabular-nums;
}

/* Vertical text support (useful for some CJK content) */
.vertical-text[lang="zh-hans"],
.vertical-text[lang="zh-hant"],
.vertical-text[lang="ja"] {
    writing-mode: vertical-rl;
    -webkit-writing-mode: vertical-rl;
    -ms-writing-mode: tb-rl;
}

/* Print optimization for CJK */
@media print {
    html[lang="zh-hans"] body,
    html[lang="zh-hant"] body,
    html[lang="ja"] body,
    html[lang="ko"] body {
        font-family: "Source Han Serif SC", "Noto Serif CJK SC", serif;
    }
}

/* High DPI screen optimization for CJK */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    html[lang="zh-hans"] body,
    html[lang="zh-hant"] body,
    html[lang="ja"] body,
    html[lang="ko"] body {
        -webkit-font-smoothing: subpixel-antialiased;
        -moz-osx-font-smoothing: auto;
    }
}
